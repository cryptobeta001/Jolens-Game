<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Marble Match Game</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(to right, #ece9e6, #ffffff);
      text-align: center;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    canvas {
      border: 3px solid #333;
      background-color: #f5f5f5;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
      margin-top: 20px;
      margin-bottom: 20px;
    }

    #score-panel {
      margin-bottom: 20px;
      background-color: #ffffff;
      padding: 15px 30px;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
      display: inline-block;
    }

    #score-panel p {
      margin: 8px 0;
      font-size: 18px;
    }

    #result {
      font-size: 22px;
      font-weight: bold;
      color: #4CAF50;
      margin-top: 10px;
    }

    button {
      font-size: 16px;
      padding: 10px 20px;
      background-color: #4CAF50;
      border: none;
      color: white;
      border-radius: 5px;
      cursor: pointer;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      transition: background-color 0.3s ease;
    }

    button:hover {
      background-color: #45a049;
    }

    @media screen and (max-width: 480px) {
      canvas {
        width: 100%;
        height: auto;
      }

      #score-panel {
        width: 90%;
      }
    }
  </style>
</head>
<body>

<h1>ðŸŽ¯ Marble Color Match Game</h1>

<canvas id="game-canvas" width="400" height="400"></canvas>

<div id="score-panel">
  <p>Player 1 Score: <span id="player1-score-value">0</span></p>
  <p>Player 2 Score: <span id="player2-score-value">0</span></p>
  <p>Level: <span id="level-value">1</span></p>
  <p id="result"></p>
</div>

<button id="reset-button">Reset Game</button>

<audio id="match-sound" src="https://www.myinstants.com/media/sounds/pop-up-kort.mp3" preload="auto"></audio>
<audio id="win-sound" src="https://www.myinstants.com/media/sounds/yeah-boy.mp3" preload="auto"></audio>

<script>
let player1Score = 0;
let player2Score = 0;
let currentPlayer = 1;
let level = 1;
let gameOver = false;
let selectedMarble = null;

const canvas = document.getElementById('game-canvas');
const ctx = canvas.getContext('2d');

const matchSound = document.getElementById('match-sound');
const winSound = document.getElementById('win-sound');

const colors = ['#FF0000', '#0000FF', '#FFFF00', '#008000'];
const marbles = [];
const gridWidth = 10;
const gridHeight = 10;
const marbleSize = 40;

class Marble {
  constructor(x, y, color) {
    this.x = x;
    this.y = y;
    this.color = color;
  }

  draw() {
    if (this.color === '') return;
    ctx.fillStyle = this.color;
    ctx.beginPath();
    ctx.arc(
      this.x * marbleSize + marbleSize / 2,
      this.y * marbleSize + marbleSize / 2,
      marbleSize / 2 - 2,
      0,
      Math.PI * 2
    );
    ctx.fill();
  }
}

function initializeMarbles() {
  marbles.length = 0;
  for (let y = 0; y < gridHeight; y++) {
    for (let x = 0; x < gridWidth; x++) {
      const color = colors[Math.floor(Math.random() * colors.length)];
      marbles.push(new Marble(x, y, color));
    }
  }
}

function getMarble(x, y) {
  return marbles.find(m => m.x === x && m.y === y);
}

function swapMarbles(m1, m2) {
  const temp = m1.color;
  m1.color = m2.color;
  m2.color = temp;
}

function checkMatch(x, y) {
  if (x < 0 || x >= gridWidth || y < 0 || y >= gridHeight) return false;
  const marble = getMarble(x, y);
  if (!marble || marble.color === '') return false;

  const targetColor = marble.color;
  let matched = [];
  const visited = new Set();

  function dfs(cx, cy) {
    const key = `${cx},${cy}`;
    if (
      cx < 0 ||
      cx >= gridWidth ||
      cy < 0 ||
      cy >= gridHeight ||
      visited.has(key)
    )
      return;
    const m = getMarble(cx, cy);
    if (!m || m.color !== targetColor) return;

    visited.add(key);
    matched.push(m);
    dfs(cx + 1, cy);
    dfs(cx - 1, cy);
    dfs(cx, cy + 1);
    dfs(cx, cy - 1);
  }

  dfs(x, y);

  if (matched.length >= 3) {
    matched.forEach(m => (m.color = ''));
    playMatchSound();
    return true;
  }

  return false;
}

function checkAnyMatch() {
  let foundMatch = false;
  for (let y = 0; y < gridHeight; y++) {
    for (let x = 0; x < gridWidth; x++) {
      if (checkMatch(x, y)) foundMatch = true;
    }
  }
  return foundMatch;
}

function clearEmptySpaces() {
  for (let x = 0; x < gridWidth; x++) {
    let column = [];
    for (let y = gridHeight - 1; y >= 0; y--) {
      const m = getMarble(x, y);
      if (m && m.color !== '') {
        column.push(m.color);
      }
    }
    for (let y = gridHeight - 1; y >= 0; y--) {
      const idx = y * gridWidth + x;
      if (column.length > 0) {
        marbles[idx].color = column.shift();
      } else {
        const color = colors[Math.floor(Math.random() * colors.length)];
        marbles[idx].color = color;
      }
    }
  }
}

function drawGrid() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.strokeStyle = '#000';
  for (let x = 0; x <= gridWidth; x++) {
    ctx.beginPath();
    ctx.moveTo(x * marbleSize, 0);
    ctx.lineTo(x * marbleSize, canvas.height);
    ctx.stroke();
  }
  for (let y = 0; y <= gridHeight; y++) {
    ctx.beginPath();
    ctx.moveTo(0, y * marbleSize);
    ctx.lineTo(canvas.width, y * marbleSize);
    ctx.stroke();
  }
}

function drawMarbles() {
  marbles.forEach(marble => {
    marble.draw();
    if (selectedMarble === marble) {
      ctx.strokeStyle = '#000000';
      ctx.lineWidth = 3;
      ctx.strokeRect(
        marble.x * marbleSize + 2,
        marble.y * marbleSize + 2,
        marbleSize - 4,
        marbleSize - 4
      );
    }
  });
}

function updateScores() {
  document.getElementById('player1-score-value').innerText = player1Score;
  document.getElementById('player2-score-value').innerText = player2Score;
  document.getElementById('level-value').innerText = level;
}

function playMatchSound() {
  matchSound.currentTime = 0;
  matchSound.play();
}

function playWinSound() {
  winSound.currentTime = 0;
  winSound.play();
}

function updateGame() {
